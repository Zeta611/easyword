// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Loader from "./Loader.js";
import * as Firebase from "./Firebase.js";
import * as Reactfire from "reactfire";
import * as Auth from "firebase/auth";
import * as ReactFirebaseui from "react-firebaseui";
import * as JsxRuntime from "react/jsx-runtime";
import * as Firestore from "firebase/firestore";
import * as RescriptReactRouter from "../node_modules/@rescript/react/src/RescriptReactRouter.js";
import App from "firebase/compat/app";

var uiConfig = {
  signInFlow: "popup",
  signInOptions: [Firebase.Auth.GoogleAuthProvider.providerID],
  callbacks: {
    signInSuccessWithAuthResult: (function (param) {
        return false;
      })
  }
};

function SignIn(props) {
  var match = Reactfire.useSigninCheck();
  var data = match.data;
  var firestore = Reactfire.useFirestore();
  React.useEffect((function () {
          if (data !== undefined && data.signedIn) {
            var user = data.user;
            if (!(user == null)) {
              var photoURL = user.photoURL;
              var email = user.email;
              var displayName = user.displayName;
              var uid = user.uid;
              ((async function (param) {
                      var userDocRef = Firestore.doc(firestore, "users/" + uid + "");
                      await Firestore.setDoc(userDocRef, {
                            displayName: displayName,
                            email: email,
                            photoURL: photoURL
                          });
                      if (displayName !== undefined) {
                        return RescriptReactRouter.replace("/");
                      } else {
                        return RescriptReactRouter.replace("/profile");
                      }
                    })(undefined));
            }
            
          }
          
        }), [data]);
  var app = App.initializeApp(Reactfire.useAuth().app.options);
  var firebaseAuth = Auth.getAuth(app);
  if (match.status === "success") {
    if (data !== undefined && !data.signedIn) {
      return JsxRuntime.jsx("div", {
                  children: JsxRuntime.jsxs("div", {
                        children: [
                          JsxRuntime.jsx("div", {
                                children: "로그인",
                                className: "text-3xl font-medium text-center"
                              }),
                          JsxRuntime.jsx(ReactFirebaseui.StyledFirebaseAuth, {
                                uiConfig: uiConfig,
                                firebaseAuth: firebaseAuth
                              })
                        ],
                        className: "h-96 w-96 bg-zinc-50 bg-opacity-30 backdrop-blur-lg drop-shadow-lg rounded-xl grid content-center gap-3 text-zinc-800 dark:text-zinc-50"
                      }),
                  className: "h-screen bg-cover bg-center bg-[url('/assets/layered-waves.svg')] justify-self-stretch grid justify-center content-center"
                });
    } else {
      return null;
    }
  } else {
    return JsxRuntime.jsx("div", {
                children: JsxRuntime.jsx(Loader.make, {}),
                className: "h-screen grid justify-center content-center"
              });
  }
}

var make = SignIn;

export {
  uiConfig ,
  make ,
}
/* react Not a pure module */
